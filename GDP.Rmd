---
title: "GDP"
author: "Jerry"
date: "10/26/2020"
output: html_document
---

```{r setup-packages, message = FALSE, warning = FALSE}
library(tidyverse)
library(plyr) #package for join command
library(broom)
```

```{r load-datasets, message = FALSE, warning = FALSE}
report_2018 <- read_csv("data/2018.csv") %>% 
  mutate(year = "2018",
         `Perceptions of corruption` = as.numeric(`Perceptions of corruption`))
report_2019 <- read_csv("data/2019.csv") %>% 
  mutate(year = "2019")

names(report_2018) <- str_replace_all(names(report_2018), c(" " = "_"))
names(report_2019) <- str_replace_all(names(report_2018), c(" " = "_"))

worldhappiness <- full_join(report_2018, report_2019)

glimpse(worldhappiness)
```

### How much does a country's GDP affect happiness score?
```{r GDP-happiness}
worldhappiness %>% 
  summarize(cor = cor(Score, GDP_per_capita))

report_2018 %>% 
  summarize(cor = cor(Score, GDP_per_capita))

report_2019 %>% 
  summarize(cor = cor(Score, GDP_per_capita))

chisq.test(worldhappiness$Score, worldhappiness$GDP_per_capita)

ggplot(worldhappiness, aes(x = GDP_per_capita, y = Score, show.legend = TRUE)) +
  geom_point(color = worldhappiness$year, show.legend = TRUE) +
  geom_smooth(method = "lm", fullrange = TRUE, color = "blue1")
```

### Calculating a 95% confidence interval for correlation between GDP and happiness score
```{r cor-interval-GDP}
#Simulation-based approach
n_sims <- 1000
boot_cors <- numeric(n_sims)
for (i in 1:n_sims){
  indices <- sample(1:nrow(worldhappiness), replace = TRUE)
  
  boot_cor <- worldhappiness %>% 
    slice(indices) %>% 
    summarize(cor = cor(Score, GDP_per_capita)) %>% 
    pull()
  
  boot_cors[i] <- boot_cor
}
boot_cors <- tibble(boot_cors)

boot_cors %>% 
  summarize(lower_bounds = quantile(boot_cors, 0.025),
            upper_bounds = quantile(boot_cors, 0.975))
```

### Linear Model Conditions
```{r create-lm, warning = FALSE}
m_score_gdp <- lm(Score ~ GDP_per_capita, data = worldhappiness)
tidy(m_score_gdp)
confint_tidy(m_score_gdp) %>% 
  slice(2)

m_gdp_aug <- augment(m_score_gdp)
```
Linearity
```{r linearlity}
ggplot(m_gdp_aug, mapping = aes(sample = .resid)) +
  stat_qq() + 
  stat_qq_line()
```
The residuals increase a little at the edges, but for a majority of the data, it seems
to follow the linear model.

Independence
Because of globalism and trans-national trade, countries are never actually independent,
but for the sake of this study, we can assume that one country's influence doesn't have enough 
of an effect to disrupt the GDP or Happiness Score of another country.

Equal Variance 
```{r equal-variance}
ggplot(m_gdp_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point() + 
  geom_hline(yintercept = 0, lwd = 2, col = "red", lty = 2) +
  labs(x = "Predicted overall score", y = "Residuals")
```

Except for the two outlier around -2, all the residuals seem to be clustered around the
residual line of 0 with no clear pattern, indicating linerality and equal variance.

Normality
```{r normality}
ggplot(m_gdp_aug, mapping = aes(x = .resid)) +
  geom_histogram(bins = 15) +
  geom_vline(xintercept = 0, color = "red", )
  labs(x = "Residuals")
```
The distribution of the residuals appears to approximately normal and centered at 0.
