---
title: "Results"
author: "Anna MacFarlane, Edgar Salas, Jerry Fu, Taalin RaoShah"
date: "10/27/2020"
output: html_document
---
### Introduction
CodeStone chose to explore the data from the World Happiness Reports of 2018 and 2019, published by the Sustainable Development Network. According to the WHR, this data is derived from the Gallup World Poll, a systematic telephone survey and in person interviews in over 160 countries whose surveys claim to represent 80%+ of the population (2014). The calls are made via random phone number generation and randomly selecting households (GWP, 2014). 

Generally, we want to explore the following question: which factors correlate most strongly to happiness across the globe? We chose to focus on four variables as well as the overall happiness score in our analysis. The four variables chosen were GDP per capita, Perceptions of Corruption, Social Support, and Life Expectancy, selected because we thought they represented economic, political, social, and medical aspects of well being respectively. Furthermore, the data set included 312 cases, each representing the data for a particular country. Guided by our general research question, we also examined the variation of their distribution by region, and which of these factors have the strongest correlations.

Considering the concerning state of our world in 2020, including the worsening effects of climate change, threats to democracy, and much more, we found it topical and insightful to evaluate what contributes to happiness within each nation and across the globe. The first World Happiness Report, published in 2012, presents the report as a means of grappling with the countless contradictions that exist in modern society such as the balance between pursuing economic success versus protecting the environment or the tradeoffs between personal profit and community trust (Helliwell et al., 2012). Eight years later, these paradoxes persit, and the potential solutions are closely linked to definitions of morality, heightening their controversy. Considering the continued debate over such questions, we believe there are grounds for further investigation into trends of happiness over time and the factors that contribute to it.


```{r setup-packages, message = FALSE, warning = FALSE}
library(tidyverse)
library(plyr) #package for join command
library(maps) #package for world map
library(broom)
```

```{r load-datasets, message = FALSE, warning = FALSE}
report_2018 <- read_csv("data/2018.csv") %>% 
  mutate(year = "2018",
         `Perceptions of corruption` = as.numeric(`Perceptions of corruption`))
report_2019 <- read_csv("data/2019.csv") %>% 
  mutate(year = "2019")
country_region <- read_csv("data/2020.csv") %>% 
  mutate(year = "2020") %>% 
  select(`Country name`, `Regional indicator`)

names(country_region) <- c("Country", "Region")
names(report_2018) <- str_replace_all(names(report_2018), c(" " = "_"))
names(report_2019) <- str_replace_all(names(report_2018), c(" " = "_"))

worldhappiness <- full_join(report_2018, report_2019) 
worldhappiness <- worldhappiness %>% 
  rename(c("Country_or_region" = "Country")) %>% 
  left_join(country_region)

glimpse(worldhappiness)
```

```{r add-region}
worldhappiness %>% 
  filter(is.na(Region))

worldhappiness <- worldhappiness %>% 
  mutate(Region = ifelse(Country == "Taiwan", "East Asia", Region)) %>%
  mutate(Region = ifelse(Country == "Qatar", "Middle East and North Africa", Region)) %>% 
  mutate(Region = ifelse(Country == "Trinidad & Tobago", "Latin America and Caribbean", Region)) %>% 
  mutate(Region = ifelse(Country == "Belize", "Latin America and Caribbean", Region)) %>% 
  mutate(Region = ifelse(Country == "Northern Cyprus", "Middle East and North Africa", Region)) %>% 
  mutate(Region = ifelse(Country == "Hong Kong", "East Asia", Region)) %>% 
  mutate(Region = ifelse(Country == "Bhutan", "South Asia", Region)) %>% 
  mutate(Region = ifelse(Country == "Somalia", "Middle East and North Africa", Region)) %>% 
  mutate(Region = ifelse(Country == "Sudan", "Middle East and North Africa", Region)) %>% 
  mutate(Region = ifelse(Country == "Angola", "Middle East and North Africa", Region)) %>% 
  mutate(Region = ifelse(Country == "Syria", "Middle East and North Africa", Region)) %>% 
  mutate(Region = ifelse(Country == "North Macedonia", "Central and Eastern Europe", Region))
```

### Is there a relationship between region of the world and happiness score?
```{r world-map, fig.width = 10, fig.height = 5}
world_map <- map_data("world") %>% 
  mutate(region = ifelse(region == "USA", "United States", region)) %>% 
  mutate(region = ifelse(region == "Democratic Republic of the Congo", "Congo (Kinshasa)", region))
  
happiness_score_map <- left_join(worldhappiness, world_map, by = c("Country" = "region"))
ggplot(happiness_score_map, aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(fill = Score), color = "white") +
  labs(title = "World Map", subtitle = "colored by Happiness Score", x = "", y = "") +
  scale_fill_viridis_c(option = "D")
```
https://www.datanovia.com/en/blog/how-to-create-a-map-using-ggplot2/

```{r chi-sq-region-score}
chisq.test(worldhappiness$Score, worldhappiness$Region)
```

### Multiple regression for all considered factors 

```{r multiple-reg-for-all}
m_happy <- lm(Score ~ Perceptions_of_corruption + Social_support +
                GDP_per_capita + Healthy_life_expectancy, data = worldhappiness)

m_happy %>% 
  tidy() %>%
  select(term, estimate) 

glance(m_happy)$r.squared
```

### Perceptions of Corruption 

```{r linear-model-corrupt, message = FALSE, warning = FALSE}
# Linear model for relationship between perceptions of corruption score and overall happiness score
m_corrupt <- lm(Score ~ Perceptions_of_corruption, data = worldhappiness)

m_corrupt %>%
  tidy() %>%
  select(term, estimate) 


# Visualization of linear model
ggplot(data = m_corrupt, aes(x = Perceptions_of_corruption,
                              y = Score)) + 
  geom_point(size = 0.8) + 
  geom_smooth(method = lm, color = "blue", size = 0.5) +
  labs(title = "Linear model for relationship between perceptions of corruption
and overall happiness score",
       subtitle = "Moderate, positive assocation",
       x = "Perceptions of corruption score",
       y = "Overall happiness score")

#Confidence interval for linear model above 
confint_tidy(m_corrupt, conf.level = 0.95) %>% 
  slice(2)

```

### Life Expectancy
```{r linear-model-life-expectancy, message=FALSE, warning=FALSE}
life_expectancy <- worldhappiness %>% 
  filter(!is.na(Healthy_life_expectancy)) %>% 
  select(Country, Score, Healthy_life_expectancy, year)

life_expectancy %>% 
  summarize(r_overall = cor(Score, Healthy_life_expectancy))

m_life <- lm(Score ~ Healthy_life_expectancy, data = worldhappiness)

m_life %>%
  tidy() %>%
  select(term, estimate) 

ggplot(data = life_expectancy, aes(x = Healthy_life_expectancy, y = Score)) + 
  geom_point(size = 0.8) + 
  geom_smooth(method = lm, color = "blue", size = 0.5) +
  theme_bw() +
  labs(title = "Linear model for relationship between healthy life expectancy and overall happiness score",
       subtitle = "Strong, positive correlation", x = "Healthy Life Expectancy Score",
       y = "Overall Happiness Score")
```

### Social Support

```{r linear-model-soc-support, warning=FALSE, message=FALSE}
#Sample stat.
socsup <- worldhappiness %>% 
  filter(!is.na(Social_support)) %>% 
  select(Country, Score, Social_support, year)

socsup %>% 
  summarize(r_overall = cor(Score, Social_support))

#Create tidy for linear model
m_score_socsup <- lm(Score ~ Social_support, data = worldhappiness)

m_score_socsup %>%
  tidy() %>%
  select(term, estimate)

#Conf. Interval
broom::confint_tidy(m_score_socsup, conf.level = 0.95)

#Model
ggplot(data = socialsupport, mapping = aes(x = Social_support, y = Score)) + 
  geom_point(size = 0.3) + 
  geom_smooth(method = "lm", color = "red", size = 0.6) + 
  labs(title = "Linear model for rltn. b/w Social Support and Happiness Score", 
       subtitle = "For the world in 2018-2019", x = "Social Support Score",
       y = "Happiness Score") + 
  theme_minimal()
```